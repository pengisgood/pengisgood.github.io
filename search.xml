<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åœ¨MySQLä¸­ä½¿ç”¨LAST_INSERT_IDèŽ·å–å”¯ä¸€è‡ªå¢žåºåˆ—]]></title>
    <url>%2F2019%2F07%2Fimplement-sequence-with-mysql-last-insert-id%2F</url>
    <content type="text"><![CDATA[ä¸€èˆ¬å¦‚æžœé‡åˆ°ç”Ÿæˆå…¨å±€å”¯ä¸€çš„è‡ªå¢žIDçš„éœ€æ±‚æ—¶ï¼Œå¾€å¾€ç¬¬ä¸€ååº”éƒ½æ˜¯ç›´æŽ¥åˆ©ç”¨æ•°æ®çš„Sequenceå¯¹è±¡ï¼Œç®€å•ï¼Œç›´æŽ¥äº†å½“ã€‚ä½†æ˜¯MySQLååä¸æ”¯æŒSequenceå¯¹è±¡ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯SequenceSequenceä¹Ÿå«åšåºåˆ—ï¼Œä¸€èˆ¬ç”¨åšè¡¨çš„ä¸»é”®ï¼Œæˆ–è€…ä¸€äº›é¡¹ç›®çš„ç¼–å·ç­‰ã€‚ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š å…¨è¡¨å”¯ä¸€ è‡ªå¢ž ä¸ä¸€å®šä¸¥æ ¼è¿žç»­ï¼ˆä¸­é—´ç”±äºŽäº‹åŠ¡çš„å›žæ»šå¯èƒ½ä¼šå‡ºçŽ°æ´žï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ6ï¼‰ åœ¨å¸¸è§çš„å‡ ç§æ•°æ®åº“ä¸­ï¼ŒOracleã€SQL Serveréƒ½å†…ç½®æœ‰Sequenceå¯¹è±¡ï¼Œå…·ä½“ç”¨æ³•å°±ä¸åœ¨æ­¤èµ˜è¿°äº†ã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹å¦‚ä½•åœ¨åŽŸç”Ÿä¸æ”¯æŒSequenceçš„MySQLï¼ˆç›®å‰æœ€æ–°çš„å¤§ç‰ˆæœ¬ä¸º8.0ï¼‰ä¸­æ¨¡æ‹Ÿå‡ºSequenceçš„æ•ˆæžœã€‚ å¦‚ä½•åœ¨MySQLä¸­æ¨¡æ‹ŸSequenceMySQLä¸­çš„auto_incrementä¸€èˆ¬æ˜¯ç”¨æ¥ç”Ÿæˆè¡¨çš„ä¸»é”®ï¼Œæœ¬èº«èƒ½å¤Ÿç”Ÿæˆè‡ªå¢žçš„å”¯ä¸€IDï¼Œä½†æ˜¯ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªåˆ—å¸¦æœ‰auto_incrementå±žæ€§ã€‚åœ¨å®žé™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸æ­¢ä¸€ç§åºåˆ—å·ï¼Œæ¯”å¦‚é¡¹ç›®ç¼–å·ï¼ˆPROJ-001ï¼ŒPROJ-002â€¦ï¼‰ã€å‘ç¥¨ç¼–å·ï¼ˆINV-0001ï¼ŒINV-0002â€¦ï¼‰ï¼Œè®¢å•ç¼–å·ï¼ˆORD-0001ï¼ŒORD-0002â€¦ï¼‰ç­‰ç­‰ï¼Œä¸‹é¢å°†é€šè¿‡auto_incrementå’ŒLAST_INSERT_IDç›¸ç»“åˆå®žçŽ°è¯¥åŠŸèƒ½ã€‚ LAST_INSERT_IDå‡½æ•°è¯¥å‡½æ•°æœ‰ä¸¤ç§å½¢å¼ï¼šLAST_INSERT_ID(), LAST_INSERT_ID(expr)ã€‚æ— å‚çš„å½¢å¼ä¼šè¿”å›žæœ€è¿‘ä¸€æ¬¡æ‰§è¡ŒINSERTè¯­å¥æ—¶auto_incrementçš„å€¼ï¼›å¸¦exprçš„å½¢å¼ä¼šè¿”å›žè¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶ä¸”è¯¥å€¼ä¼šè¢«è®°ä½ï¼Œåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨LAST_INSERT_ID()æ—¶ä¹Ÿè¿”å›žè¯¥å€¼ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ é¦–å…ˆåˆ›å»ºä¸€å¼ è¡¨ï¼š 1234CREATE TABLE user ( id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(50) NOT NULL); ç„¶åŽæ’å…¥ä¸¤æ¡æ•°æ®ï¼š 1234INSERT INTO user(name) VALUES(&apos;å¼ ä¸‰&apos;);INSERT INTO user(name) VALUES(&apos;æŽå››&apos;);SELECT LAST_INSERT_ID(); æ­¤æ—¶å¾—åˆ°çš„ç»“æžœæ˜¯2ã€‚ æ³¨æ„ï¼šå¦‚æžœæ˜¯ä¸€æ¡è¯­å¥æ’å…¥å¤šæ¡å€¼ï¼Œåˆ™è¿”å›žçš„æ˜¯æ’å…¥ç¬¬ä¸€æ¡æ—¶è‡ªåŠ¨ç”Ÿæˆçš„IDï¼Œè€Œä¸æ˜¯æœ€åŽä¸€æ¡çš„ã€‚ æ¯”å¦‚æˆ‘ä»¬å†æ’å…¥ä¸‰æ¡æ•°æ®ï¼Œä¸è¿‡æ¢ä¸ªå†™æ³•ï¼š 123456INSERT INTO user(name) VALUES(&apos;çŽ‹äº”&apos;), (&apos;èµµå…­&apos;), (&apos;éƒ‘ä¸ƒ&apos;);SELECT LAST_INSERT_ID(); æ­¤æ—¶å¾—åˆ°çš„ç»“æžœæ˜¯3ï¼Œè€Œä¸æ˜¯5ã€‚ èŽ·å–è‡ªå¢žåºåˆ—åœ¨å®žé™…çš„é¡¹ç›®ä¸­æˆ‘ä»¬å®Œå…¨å¯ä»¥æ¢ä¸ªæ–¹å¼ï¼Œé¿å…ä¸Šé¢ðŸ‘†çš„æƒ…å†µï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä½•å¿…æ²¡æœ‰å›°éš¾ï¼Œåˆ¶é€ å›°éš¾ä¸ºéš¾è‡ªå·±å‘¢ï¼ŸæŽ¥ç€çœ‹ä¸‹ä¸€ä¸ªæ›´åŠ é€šç”¨çš„ä¾‹å­ã€‚ åˆ›å»ºå¦ä¸€å¼ è¡¨å¹¶åˆå§‹åŒ–æ•°æ®ï¼š 12345678CREATE TABLE sequence ( id INT AUTO_INCREMENT PRIMARY KEY, seq_type VARCHAR(50) NOT NULL, year INT NOT NULL, current_val BIGINT NOT NULL);INSERT INTO sequence(seq_type, year, current_val) VALUES(&apos;INVOICE&apos;, 2019, 0); æ¯æ¬¡åœ¨èŽ·å–current_valä¹‹å‰ï¼Œå…ˆé€šè¿‡LAST_INSERT_ID(current_val + 1)æ›´æ–°ï¼š 12345UPDATE sequence SET current_val = LAST_INSERT_ID(current_val + 1)WHERE seq_type = &apos;INVOICE&apos; AND year = 2019;SELECT LAST_INSERT_ID(); è¿™æ ·æ¯æ¬¡éƒ½èƒ½èŽ·å–è‡ªå¢žä¹‹åŽçš„å€¼äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µã€‚æ¯”å¦‚ä¸¤ä¸ªäººåŒæ—¶åœ¨èŽ·å–æ–°çš„å€¼ï¼ŒAå…ˆåšäº†updateæ“ä½œï¼Œç„¶åŽBä¹Ÿåšäº†updateæ“ä½œï¼Œç„¶åŽAçš„æ“ä½œç”±äºŽæŸç§åŽŸå› å›žæ»šäº†ï¼ŒBçš„æ“ä½œæˆåŠŸäº†ï¼Œæ­¤æ—¶åºåˆ—ä¸­é—´å°±ä¼šå‡ºçŽ°ä¸€ä¸ªæ´žã€‚è™½ç„¶ä¸æ˜¯ä¸¥æ ¼è¿žç»­çš„ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå·²ç»æ»¡è¶³è¦æ±‚äº†ã€‚ è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœseq_typeæˆ–è€…yearæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè¿™é‡Œçš„SELECT LAST_INSERT_ID();å°±ä¼šå§‹ç»ˆè¿”å›žä¸Šä¸€æ¬¡çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„çš„é”™è¯¯ã€‚ LAST_INSERT_ID() vs. MAX()LAST_INSERT_ID()æ˜¯ä»¥æ•°æ®åº“è¿žæŽ¥ä¸ºåŸºç¡€çš„ï¼Œå³ä½¿æœ‰å¤šä¸ªäººåŒæ—¶é€šè¿‡å¤šä¸ªè¿žæŽ¥èŽ·å–Sequenceä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä¼šèŽ·å–åˆ°å±žäºŽä»–è‡ªå·±çš„åºåˆ—å·ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå—åˆ°å…¶ä»–å®¢æˆ·ç«¯çš„å½±å“ï¼Œæˆ–è€…å½±å“å…¶ä»–å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMAX()ææ€•å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ã€‚ å‚è€ƒé“¾æŽ¥ https://www.percona.com/community-blog/2018/10/12/generating-identifiers-auto_increment-sequence/ https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id http://www.mysqltutorial.org/mysql-last_insert_id.aspx]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F07%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
  </entry>
  <entry>
    <title><![CDATA[categories]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽæˆ‘]]></title>
    <url>%2Fabout%2Findex.html</url>
    <content type="text"><![CDATA[ç®€åŽ†æ›´æ–°ä¸­â€¦]]></content>
  </entry>
</search>
