<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Coding Life</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="codinglife.tech/"/>
  <updated>2019-07-15T15:44:59.356Z</updated>
  <id>codinglife.tech/</id>
  
  <author>
    <name>Max Peng</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åœ¨MySQLä¸­ä½¿ç”¨LAST_INSERT_IDè·å–å”¯ä¸€è‡ªå¢åºåˆ—</title>
    <link href="codinglife.tech/2019/07/implement-sequence-with-mysql-last-insert-id/"/>
    <id>codinglife.tech/2019/07/implement-sequence-with-mysql-last-insert-id/</id>
    <published>2019-07-15T12:03:02.000Z</published>
    <updated>2019-07-15T15:44:59.356Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€èˆ¬å¦‚æœé‡åˆ°ç”Ÿæˆå…¨å±€å”¯ä¸€çš„è‡ªå¢IDçš„éœ€æ±‚æ—¶ï¼Œå¾€å¾€ç¬¬ä¸€ååº”éƒ½æ˜¯ç›´æ¥åˆ©ç”¨æ•°æ®çš„Sequenceå¯¹è±¡ï¼Œç®€å•ï¼Œç›´æ¥äº†å½“ã€‚ä½†æ˜¯MySQLååä¸æ”¯æŒSequenceå¯¹è±¡ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿ</p><h2 id="ä»€ä¹ˆæ˜¯Sequence"><a href="#ä»€ä¹ˆæ˜¯Sequence" class="headerlink" title="ä»€ä¹ˆæ˜¯Sequence"></a>ä»€ä¹ˆæ˜¯Sequence</h2><p>Sequenceä¹Ÿå«åšåºåˆ—ï¼Œä¸€èˆ¬ç”¨åšè¡¨çš„ä¸»é”®ï¼Œæˆ–è€…ä¸€äº›é¡¹ç›®çš„ç¼–å·ç­‰ã€‚ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>å…¨è¡¨å”¯ä¸€</li><li>è‡ªå¢</li><li>ä¸ä¸€å®šä¸¥æ ¼è¿ç»­ï¼ˆä¸­é—´ç”±äºäº‹åŠ¡çš„å›æ»šå¯èƒ½ä¼šå‡ºç°<code>æ´</code>ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ6ï¼‰</li></ul><a id="more"></a><p>åœ¨å¸¸è§çš„å‡ ç§æ•°æ®åº“ä¸­ï¼ŒOracleã€SQL Serveréƒ½å†…ç½®æœ‰Sequenceå¯¹è±¡ï¼Œå…·ä½“ç”¨æ³•å°±ä¸åœ¨æ­¤èµ˜è¿°äº†ã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹å¦‚ä½•åœ¨åŸç”Ÿä¸æ”¯æŒSequenceçš„MySQLï¼ˆç›®å‰æœ€æ–°çš„å¤§ç‰ˆæœ¬ä¸º8.0ï¼‰ä¸­æ¨¡æ‹Ÿå‡ºSequenceçš„æ•ˆæœã€‚</p><h2 id="å¦‚ä½•åœ¨MySQLä¸­æ¨¡æ‹ŸSequence"><a href="#å¦‚ä½•åœ¨MySQLä¸­æ¨¡æ‹ŸSequence" class="headerlink" title="å¦‚ä½•åœ¨MySQLä¸­æ¨¡æ‹ŸSequence"></a>å¦‚ä½•åœ¨MySQLä¸­æ¨¡æ‹ŸSequence</h2><p>MySQLä¸­çš„<code>auto_increment</code>ä¸€èˆ¬æ˜¯ç”¨æ¥ç”Ÿæˆè¡¨çš„ä¸»é”®ï¼Œæœ¬èº«èƒ½å¤Ÿç”Ÿæˆè‡ªå¢çš„å”¯ä¸€IDï¼Œä½†æ˜¯ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªåˆ—å¸¦æœ‰<code>auto_increment</code>å±æ€§ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸æ­¢ä¸€ç§åºåˆ—å·ï¼Œæ¯”å¦‚é¡¹ç›®ç¼–å·ï¼ˆPROJ-001ï¼ŒPROJ-002â€¦ï¼‰ã€å‘ç¥¨ç¼–å·ï¼ˆINV-0001ï¼ŒINV-0002â€¦ï¼‰ï¼Œè®¢å•ç¼–å·ï¼ˆORD-0001ï¼ŒORD-0002â€¦ï¼‰ç­‰ç­‰ï¼Œä¸‹é¢å°†é€šè¿‡<code>auto_increment</code>å’Œ<code>LAST_INSERT_ID</code>ç›¸ç»“åˆå®ç°è¯¥åŠŸèƒ½ã€‚</p><h3 id="LAST-INSERT-IDå‡½æ•°"><a href="#LAST-INSERT-IDå‡½æ•°" class="headerlink" title="LAST_INSERT_IDå‡½æ•°"></a>LAST_INSERT_IDå‡½æ•°</h3><p>è¯¥å‡½æ•°æœ‰ä¸¤ç§å½¢å¼ï¼š<a href="https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id" target="_blank" rel="noopener"><code>LAST_INSERT_ID()</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id" target="_blank" rel="noopener"><code>LAST_INSERT_ID(expr)</code></a>ã€‚æ— å‚çš„å½¢å¼ä¼šè¿”å›æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œ<code>INSERT</code>è¯­å¥æ—¶<code>auto_increment</code>çš„å€¼ï¼›å¸¦<code>expr</code>çš„å½¢å¼ä¼šè¿”å›è¡¨è¾¾å¼çš„å€¼ï¼Œå¹¶ä¸”è¯¥å€¼ä¼šè¢«è®°ä½ï¼Œåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨<code>LAST_INSERT_ID()</code>æ—¶ä¹Ÿè¿”å›è¯¥å€¼ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p><p>é¦–å…ˆåˆ›å»ºä¸€å¼ è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user (</span><br><span class="line">    id INT AUTO_INCREMENT PRIMARY KEY,</span><br><span class="line">    name VARCHAR(50) NOT NULL</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç„¶åæ’å…¥ä¸¤æ¡æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user(name) VALUES(&apos;å¼ ä¸‰&apos;);</span><br><span class="line">INSERT INTO user(name) VALUES(&apos;æå››&apos;);</span><br><span class="line"></span><br><span class="line">SELECT LAST_INSERT_ID();</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¾—åˆ°çš„ç»“æœæ˜¯2ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>å¦‚æœæ˜¯ä¸€æ¡è¯­å¥æ’å…¥å¤šæ¡å€¼ï¼Œåˆ™è¿”å›çš„æ˜¯æ’å…¥ç¬¬ä¸€æ¡æ—¶è‡ªåŠ¨ç”Ÿæˆçš„IDï¼Œè€Œä¸æ˜¯æœ€åä¸€æ¡çš„ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å†æ’å…¥ä¸‰æ¡æ•°æ®ï¼Œä¸è¿‡æ¢ä¸ªå†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user(name) </span><br><span class="line">VALUES(&apos;ç‹äº”&apos;),</span><br><span class="line">      (&apos;èµµå…­&apos;),</span><br><span class="line">      (&apos;éƒ‘ä¸ƒ&apos;);</span><br><span class="line"></span><br><span class="line">SELECT LAST_INSERT_ID();</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¾—åˆ°çš„ç»“æœæ˜¯3ï¼Œè€Œ<strong>ä¸æ˜¯</strong>5ã€‚</p><h3 id="è·å–è‡ªå¢åºåˆ—"><a href="#è·å–è‡ªå¢åºåˆ—" class="headerlink" title="è·å–è‡ªå¢åºåˆ—"></a>è·å–è‡ªå¢åºåˆ—</h3><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­æˆ‘ä»¬å®Œå…¨å¯ä»¥æ¢ä¸ªæ–¹å¼ï¼Œé¿å…ä¸Šé¢ğŸ‘†çš„æƒ…å†µï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œä½•å¿…æ²¡æœ‰å›°éš¾ï¼Œåˆ¶é€ å›°éš¾ä¸ºéš¾è‡ªå·±å‘¢ï¼Ÿæ¥ç€çœ‹ä¸‹ä¸€ä¸ªæ›´åŠ é€šç”¨çš„ä¾‹å­ã€‚</p><p>åˆ›å»ºå¦ä¸€å¼ è¡¨å¹¶åˆå§‹åŒ–æ•°æ®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE sequence (</span><br><span class="line">    id INT AUTO_INCREMENT PRIMARY KEY,</span><br><span class="line">    seq_type VARCHAR(50) NOT NULL,</span><br><span class="line">    year INT NOT NULL,</span><br><span class="line">    current_val BIGINT NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO sequence(seq_type, year, current_val) VALUES(&apos;INVOICE&apos;, 2019, 0);</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡åœ¨è·å–<code>current_val</code>ä¹‹å‰ï¼Œå…ˆé€šè¿‡<code>LAST_INSERT_ID(current_val + 1)</code>æ›´æ–°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPDATE sequence </span><br><span class="line">SET current_val = LAST_INSERT_ID(current_val + 1)</span><br><span class="line">WHERE seq_type = &apos;INVOICE&apos; AND year = 2019;</span><br><span class="line"></span><br><span class="line">SELECT LAST_INSERT_ID();</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ¯æ¬¡éƒ½èƒ½è·å–è‡ªå¢ä¹‹åçš„å€¼äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–çš„æƒ…å†µã€‚æ¯”å¦‚ä¸¤ä¸ªäººåŒæ—¶åœ¨è·å–æ–°çš„å€¼ï¼ŒAå…ˆåšäº†updateæ“ä½œï¼Œç„¶åBä¹Ÿåšäº†updateæ“ä½œï¼Œç„¶åAçš„æ“ä½œç”±äºæŸç§åŸå› å›æ»šäº†ï¼ŒBçš„æ“ä½œæˆåŠŸäº†ï¼Œæ­¤æ—¶åºåˆ—ä¸­é—´å°±ä¼šå‡ºç°ä¸€ä¸ª<code>æ´</code>ã€‚è™½ç„¶ä¸æ˜¯ä¸¥æ ¼è¿ç»­çš„ï¼Œä½†æ˜¯åœ¨å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå·²ç»æ»¡è¶³è¦æ±‚äº†ã€‚</p><p><strong>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œå¦‚æœ<code>seq_type</code>æˆ–è€…<code>year</code>æ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè¿™é‡Œçš„<code>SELECT LAST_INSERT_ID();</code>å°±ä¼šå§‹ç»ˆè¿”å›ä¸Šä¸€æ¬¡çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„çš„é”™è¯¯ã€‚</p><h2 id="LAST-INSERT-ID-vs-MAX"><a href="#LAST-INSERT-ID-vs-MAX" class="headerlink" title="LAST_INSERT_ID() vs. MAX()"></a>LAST_INSERT_ID() vs. MAX()</h2><p><code>LAST_INSERT_ID()</code>æ˜¯ä»¥æ•°æ®åº“è¿æ¥ä¸ºåŸºç¡€çš„ï¼Œå³ä½¿æœ‰å¤šä¸ªäººåŒæ—¶é€šè¿‡å¤šä¸ªè¿æ¥è·å–Sequenceä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯ä¼šè·å–åˆ°å±äºä»–è‡ªå·±çš„åºåˆ—å·ï¼Œä¸ç”¨æ‹…å¿ƒä¼šå—åˆ°å…¶ä»–å®¢æˆ·ç«¯çš„å½±å“ï¼Œæˆ–è€…å½±å“å…¶ä»–å®¢æˆ·ç«¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>MAX()</code>ææ€•å°±ä¸å·¥ä½œäº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><blockquote><ul><li><a href="https://www.percona.com/community-blog/2018/10/12/generating-identifiers-auto_increment-sequence/" target="_blank" rel="noopener">https://www.percona.com/community-blog/2018/10/12/generating-identifiers-auto_increment-sequence/</a></li><li><a href="https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id</a></li><li><a href="http://www.mysqltutorial.org/mysql-last_insert_id.aspx" target="_blank" rel="noopener">http://www.mysqltutorial.org/mysql-last_insert_id.aspx</a></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸€èˆ¬å¦‚æœé‡åˆ°ç”Ÿæˆå…¨å±€å”¯ä¸€çš„è‡ªå¢IDçš„éœ€æ±‚æ—¶ï¼Œå¾€å¾€ç¬¬ä¸€ååº”éƒ½æ˜¯ç›´æ¥åˆ©ç”¨æ•°æ®çš„Sequenceå¯¹è±¡ï¼Œç®€å•ï¼Œç›´æ¥äº†å½“ã€‚ä½†æ˜¯MySQLååä¸æ”¯æŒSequenceå¯¹è±¡ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•æ˜¯å¥½å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯Sequence&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯Sequence&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯Sequence&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯Sequence&lt;/h2&gt;&lt;p&gt;Sequenceä¹Ÿå«åšåºåˆ—ï¼Œä¸€èˆ¬ç”¨åšè¡¨çš„ä¸»é”®ï¼Œæˆ–è€…ä¸€äº›é¡¹ç›®çš„ç¼–å·ç­‰ã€‚ä¸€èˆ¬å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…¨è¡¨å”¯ä¸€&lt;/li&gt;
&lt;li&gt;è‡ªå¢&lt;/li&gt;
&lt;li&gt;ä¸ä¸€å®šä¸¥æ ¼è¿ç»­ï¼ˆä¸­é—´ç”±äºäº‹åŠ¡çš„å›æ»šå¯èƒ½ä¼šå‡ºç°&lt;code&gt;æ´&lt;/code&gt;ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3ï¼Œ5ï¼Œ6ï¼‰&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="database" scheme="codinglife.tech/categories/database/"/>
    
    
      <category term="mysql" scheme="codinglife.tech/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="codinglife.tech/2019/07/hello-world/"/>
    <id>codinglife.tech/2019/07/hello-world/</id>
    <published>2019-07-11T03:18:39.829Z</published>
    <updated>2019-07-15T15:06:17.694Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><a id="more"></a><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo new &lt;span class=&quot;string&quot;&gt;&quot;My New Post&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/writing.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Writing&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
